<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>분실물 등록</title>
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/contents.css">
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/addLostThings.css">
</head>
</head>
<body>
<header id="header"></header>
<section id="contents">
    <div class="inner">
        <div id="addDiv">
            <div id="addHeader">
                분실물 등록
            </div>
            <form id="lostItemForm" action="/addLostThing" method="post">
                <div id="lostTingName" class="lostItems">
                    <label for="itemName">분실물 이름:</label>
                    <input type="text" id="itemName" name="itemName" required><br><br>
                </div>
                <div id="lostThingPlace" class="lostItems">
                    <label for="itemLocation">습득한 장소:</label>
                    <input type="text" id="itemLocation" name="itemLocation" required>
                </div>
                <div id="selectedPlace" class="lostItems">
                    <h3>선택한 장소</h3>
                    <p id="selectedPlaceName"></p>
                    <p id="selectedPlaceAddress"></p>
                </div>

                <input type="hidden" id="selectedPlaceNameInput" name="selectedPlaceName" required>
                <input type="hidden" id="selectedPlaceAddressInput" name="selectedPlaceAddress" required>
                <div id="map" style="width: 100%; height:300px;"></div><br>
                <div class="lostItems">
                    <label for="detailContents">내용:</label>
                    <input id="detailContents" name="detailContents" style="width:600px; height:300px;">
                </div>
                <span id="submitDiv"><input type="submit" value="등록" id="submitBtn"></span>
            </form>
        </div>
    </div>
</section>
<footer id="footer"></footer>
<script src="/javascript/fetchMainHF.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=5f47e6cf98a4ba29bc196fbed43f7531&libraries=services"></script>
<script>
    $(document).ready(function() {
        var selectedMarker = null;

        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: new kakao.maps.LatLng(37.566826, 126.9786567),
            level: 5
        };
        var map = new kakao.maps.Map(mapContainer, mapOption);

        $('#itemLocation').on('input change', function() {
            var keyword = $(this).val();
            if (keyword !== '') {
                var places = new kakao.maps.services.Places();
                places.keywordSearch(keyword, function(result, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        var place = result[0];
                        var latlng = new kakao.maps.LatLng(place.y, place.x);

                        if (selectedMarker) {
                            selectedMarker.setMap(null);
                        }

                        var marker = new kakao.maps.Marker({
                            position: latlng
                        });
                        marker.setMap(map);
                        map.setCenter(latlng);

                        kakao.maps.event.addListener(marker, 'click', function() {
                            if (selectedMarker) {
                                selectedMarker.setZIndex(0);
                            }
                            selectedMarker = marker;
                            selectedMarker.setZIndex(1);

                            $('#selectedPlaceName').text(place.place_name);
                            $('#selectedPlaceAddress').text(place.address_name);
                            updateHiddenInputs();
                        });

                        $('#selectedPlaceName').text(place.place_name);
                        $('#selectedPlaceAddress').text(place.address_name);
                        updateHiddenInputs();
                    }
                });
            }
        });

        $("#lostItemForm").submit(function(event) {
            updateHiddenInputs();
            console.log("폼이 제출되었습니다.");
            console.log("선택한 장소 이름: " + $("#selectedPlaceNameInput").val());
            console.log("선택한 장소 주소: " + $("#selectedPlaceAddressInput").val());
        });

        function updateHiddenInputs() {
            var selectedPlaceName = $("#selectedPlaceName").text();
            var selectedPlaceAddress = $("#selectedPlaceAddress").text();
            $("#selectedPlaceNameInput").val(selectedPlaceName);
            $("#selectedPlaceAddressInput").val(selectedPlaceAddress);
            console.log("Hidden inputs updated: ", selectedPlaceName, selectedPlaceAddress);
        }
    });
</script>
</body>
</html>
